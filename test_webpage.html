<html>

<body>

	<br><br><br>

	<center>
	<h1>
		Total time left: <b id="time">600</b>

		<br><br>

		Time to type this number: <b id="timeProblem">4</b>

		<br><br>

		Type the number <b id="num">123456</b>.
	</h1>

	<br><br>

	<input type="number" id="ans" />

	<br><br>

	<h1>
		Score: <b id="score">0</b>

		<br><br>

	</h1>

	</center>

	<div id="counter">0</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="setImmediate.js"></script>
	<script>

		/*
		 * Stressor from: https://link.springer.com/article/10.1007/s00421-004-1055-z
		 * "The effect of mental stress on heart rate variability and blood pressure during computer work"
		 */

		var INTERVENTION = 3; // 0 = nothing, 1 = just green, 3 = flashes 

		if (INTERVENTION === 1) document.body.style.backgroundColor = "#00FF00";

		function getRandomInt(max) {
			return Math.floor(Math.random() * Math.floor(max));
		}

		var score = 0;
		var currNumber = getRandomInt(999999);
		$("#num").text(currNumber + "");
		var timeProblem = 4;
		var timeLeft = 240;

		$(document).ready(function() {

			var count = 0;

			$("#ans").on("change paste keyup", function() {
    			var num = parseInt($("#ans").val());
    			if (num === currNumber) {
    				score++;
    				currNumber = getRandomInt(999999);
    				$("#num").text(currNumber + "");
    				$("#score").text(score + "");
    				$("#ans").val("");
    			}
    		});
		
			var update1 = function() {
				count++;
				$("#counter").html(count);

				if (INTERVENTION === 2) {
					if (count % 3000 === 0) {
						document.body.style.backgroundColor = "#00FF00";
						setImmediate(update2);
					}
				}

				if (INTERVENTION === 3) {
					if (count % 900 === 0) {
						document.body.style.backgroundColor = "#00FF00";
						setImmediate(update2);
					}
				}
	
				if (count % 4000 === 0 && timeLeft > 0) {
					timeLeft--;
					timeProblem--;
					if (timeProblem < 0) {
						timeProblem = 4;
						score--;
						$("#score").text(score + "");
					}
					$("#time").text(timeLeft + "");
					$("#timeProblem").text(timeProblem + "");
				}

				setImmediate(update1);
			};

			var update2 = function() {
				document.body.style.backgroundColor = "#FFFFFF"; 
			}

			setImmediate(update1);

		});
	</script>
</body>


</html>